# Default configuration for citation embedding training and evaluation

data:
  data_dir: data/v2
  hf_dataset_name: "akalmbach-kinsol/generative-papers-arxiv"
  citations_batch_size: 10000
  basemodel_name: "sentence-transformers/allenai-specter"
  
  # Dataset building settings
  test_size: 0.05  # Fraction of papers to use for test set
  random_seed: 42  # Random seed for train/test split
  
  # Collation settings
  max_length: 256
  pad_to_multiple_of: 8
  pad_value: 0.0

model:
  hidden_size: 768
  num_hidden_layers: 2
  num_attention_heads: 12
  intermediate_size: 1536
  max_position_embeddings: 2048

training:
  batch_size: 320
  num_workers: 6
  learning_rate: 1e-3
  
  # Training duration
  max_steps: 50000  # Total training steps
  warmup_steps: 1000  # Linear warmup steps before cosine decay
  
  # Gradient clipping
  grad_clip_norm: 1.0  # Max norm for gradient clipping (null = no clipping)
  
  # Logging
  log_steps: 10
  save_steps: 500
  tensorboard_dir: runs

evaluation:
  batch_size: 16
  num_workers: 0
  max_batches: 100  # null = evaluate all batches

rectflow:
  # Velocity field architecture
  velocity_field_type: "DiT"  # "DiT" or "CrossAttention"
  num_blocks: 4  # Number of transformer blocks in velocity field
  num_heads: 4  # Number of attention heads
  mlp_ratio: 6.0  # MLP expansion ratio
  
  # Conditioning model
  conditioning_checkpoint: null  # Path to conditioning model checkpoint (null = auto-find latest in runs/)

rectflow_training:
  batch_size: 128
  num_workers: 8
  learning_rate: 2e-4
  min_lr_ratio: 0.1  # Final LR fraction after cosine decay
  max_grad_norm: 1.0
  
  # Training duration
  max_steps: 50000  # Total training steps
  warmup_steps: 1000  # Linear warmup steps before cosine decay
  
  # Gradient clipping
  grad_clip_norm: 1.0  # Max norm for gradient clipping (null = no clipping)
  
  # Time weighting
  train_time_weight: "uniform"  # "uniform" or "linear"
  train_time_distribution: "lognormal"  # "uniform" or "lognormal"
  
  # Logging
  log_steps: 10
  save_steps: 500
  tensorboard_dir: runs_rectflow
